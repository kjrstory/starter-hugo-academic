---
title: 2-07 답변 등록
date: '2023-11-03'
type: book
weight: 4
math: true
tags:
  - Python
  - FastAPI
  - Vue
---

- `완성 소스` : https://github.com/kjrstory/fastapi_vue/tree/v2.07
- `점프 투 FastAPI 문서` : https://wikidocs.net/176499


먼저 점프 투 FastAPI에서 API를 만들고 온다. main.py, frontend/src/lib/api.js도 수정한다.
답변과 질문 스키마 파일도 책에 따라 수정한다.

## 1. 답변 등록 추가

frontend/views/PageDetail.vue 파일을 다음과 같이 수정하자.
```vue{hl_lines=["5-8",46,"35-46"]}
<template>
  <div>
    <h1>{{ question.subject }}</h1>
    <div>{{ question.content }}</div>
    <form @submit.prevent="postAnswer">
      <textarea rows="15" v-model="content"></textarea>
      <input type="submit" value="답변등록">
    </form>
  </div>
</template>

<script>
import fastapi from '../lib/api';

export default {
  props: {
    question_id: {
      type: String,
      required: true
    }
  },
  data() {
    return {
      question: { answers: [] },
      content: "",
    };
  },
  methods: {
    getQuestion() {
      let url = `/api/question/detail/${this.question_id}`
      fastapi('get', url, {}, (json) => {
        this.question = json;
      });
    },
    postAnswer() {
      let url = `/api/answer/create/${this.question_id}`
      let params = {
        content: this.content
      }
      fastapi('post', url, params, () => {
        this.content = ""
        this.getQuestion()
       },
      )
    },
  },  
  created() {
    this.getQuestion();
  }
}
</script>
```

@submit.prevent="postAnswer": 폼이 제출되면 기본 동작을 방지하고 postAnswer 메서드를 호출한다. @submit은 폼 제출 이벤트를 처리하고, .prevent는 이벤트의 기본 동작을 방지하는것이다.
이것은 Svelte에서는 function에서 event.preventDefault()를 사용하였다. Vue.js에서도 메서드에 event.preventDefault()를 사용하는 것이 가능하다. 
또 Svelte에서 textarea에 바인딩하는것은 Vue에서는 v-model이다. 

## 2. 질문 상세 화면에 답변 표시하기


`[파일명: frontend/src/views/PageDetail.vue.js]`
```vue{hl_lines=["5-7"]}
<template>
  <div>
    <h1>{{ question.subject }}</h1>
    <div>{{ question.content }}</div>
    <ul>
    <li v-for="answer in question.answers" :key="answer.id">{{ answer.content }}</li>
    </ul>
    <form @submit.prevent="postAnswer">
      <textarea rows="15" v-model="content"></textarea>
      <input type="submit" value="답변등록">
    </form>
  </div>
</template>
(... 생략 ...)
```

PageHome파일의 질문 목록 부분과 매우 유사하다. answer는 따로 받아오지 않고 question.answers로 질문에 달린 답변 리스트를 받을 수있다. 
