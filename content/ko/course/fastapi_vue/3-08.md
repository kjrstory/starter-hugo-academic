---
title: 3-08 로그인과 로그아웃
date: '2023-11-01'
type: book
weight: 18
math: true
tags:
  - Python
  - FastAPI
  - Vue
---

- `완성 소스` : https://github.com/kjrstory/fastapi_vue/tree/v3.08
- `점프 투 FastAPI 문서` : https://wikidocs.net/176934


## 라우터



`[파일명: frontend/src/router/index.js]`
```
import PageDetail from '@/views/PageDetail.vue'
import QuestionCreate from '@/views/QuestionCreate.vue'
import UserCreate from "@/views/UserCreate.vue"
import UserLogin from "@/views/UserLogin.vue"

const routes = [
  {
	@@ -25,7 +26,12 @@ const routes = [
    path: '/user-create',
    name: 'UserCreate',
    component: UserCreate
  },
  {
    path: '/user-login',
    name: 'UserLogin',
    component: UserLogin
  },
]
```




## 로그인 화면 작성하기

`[파일명: frontend/src/views/UserLogin.vue.js]`
```vue{hl_lines=["5-7"]}
<template>
  <div class="container">
    <h5 class="my-3 border-bottom pb-2">로그인</h5>
    <form @submit.prevent="loginUser">
      <div class="mb-3">
        <label for="username">사용자 이름</label>
        <input type="text" class="form-control" id="username" v-model="login_username">
      </div>
      <div class="mb-3">
        <label for="password">비밀번호</label>
        <input type="password" class="form-control" id="password" v-model="login_password">
      </div>
      <button type="submit" class="btn btn-primary">로그인</button>
    </form>
  </div>
</template>

<script>
import fastapi from "../lib/api"
export default {
  data() {
    return {
      login_username: '',
      login_password: ''
    }
  },
  methods: {
    loginUser() {
      let url = "/api/user/login"
      let params = {
        username: this.login_username,
        password: this.login_password,
      }
      fastapi('login', url, params,
        (json) => {
          this.$store.dispatch("setAccessToken", json.access_token)
          this.$store.dispatch("setUsername", json.username)
          this.$store.dispatch("setIsLogin", true)
          this.$router.push("/")
        }
      )
    }
  }
}
</script>
```

## 스토어 변수 사용하기

```
const store = createStore({
  plugins: [persistedstate()],
  state: {
    page: 0,
    access_token: "",
    username: "",
    is_login: false 
  },
  mutations: {
    setPage(state, payload) {
      state.page = payload
    },
    setAccessToken(state, token) {
      state.access_token = token
    },
    setUsername(state, username) {
      state.username = username
    },
    setIsLogin(state, is_login) {
      state.is_login = is_login
    }
  },
  actions: {
    setPage(context, payload) {
      context.commit('setPage', payload)
    },
    setAccessToken(context, payload) {
      context.commit('setAccessToken', payload)
    },
    setUsername(context, payload) {
      context.commit('setUsername', payload)
    },
    setIsLogin(context, payload) {
      context.commit('setIsLogin', payload)
    }
  },
  getters: {
    getPage: (state) => state.page,
  }
})
```

## 로그아웃 링크


```
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item" v-if="is_login">
             <a class="nav-link" href="/user-login" @click.prevent="logoutUser">로그아웃 ({{ username }})</a>
          </li>
          <li class="nav-item" v-if="!is_login">
            <router-link to="/user-create" class="nav-link">회원가입</router-link>
          </li>  
          <li class="nav-item" v-if="!is_login">  
            <router-link to="/user-login" class="nav-link">로그인</router-link>
          </li>
        </ul>
	@@ -28,9 +31,22 @@

<script>
export default {
  computed: {
      is_login() {
        return this.$store.state.is_login;
      },
      username() {
        return this.$store.state.username;
      },
  },
  methods: {
    setPage(page) {
      this.$store.dispatch('setPage', page);
    },
    logoutUser() {
      this.$store.dispatch("setAccessToken", "")
      this.$store.dispatch("setUsername", "")
      this.$store.dispatch("setIsLogin", false)
    }
  }
}
```
