---
title: 상용 및 오픈소스 CFD 코드를 이용한 EFD-CFD 워크샵 Case 3 해석
date: '2017-01-01'
draft: false
publishDate: '2023-06-05T08:29:47.875335Z'
authors:
- ' 김종록'
publication_types:
- '2'
abstract: EFD-CFD 워크샵 중 Case3인 RAE Wing A 형상에 대해 전산유체역학 해석을 수행하였다. 해석자로 3개의 상용 CFD
  해석 코드(Star-CCM+, Fluent, CFX)와 오픈 소스 CFD 코드(SU2)를 사용하였다. 격자는 상용 격자 생성 코드인 Pointwise를
  이용하여 격자의 수에 따라 4가지를 생성하였다. 마하수 0.4, 0.8에서 는 받음각 2도, 마하수 0.9에서 받음각 1도에서 해석하였다. coarse격자부터
  fine 격자까지는 압력계수 곡선과 수직력 계수는 비슷한 결과를 보였으나 항력 계수에서는 차이가 있었다. Star-CCM+과 Fluent의 해석에서
  차분법의 차수가 높을수록 충격파의 위치를 앞으로 예측하였다. 수렴에 다다르는 계산시간은 Fluent, Star-CCM+, CFX의 순으로 나타났고
  SU2는 이에 비해 수렴하는데 많은 시간이 들었다.
featured: false
publication: '*한국항공우주학회지, 45(3)*'
doi: 10.5139/JKSAS.2017.45.3.241
tags:
- CFD(전산유체역학)
- CFX
- EFD-CFD
- Fluent
- RAE-A
- Star-CCM+
- SU2
---

[EFD-CFD 워크샵](https://efd-cfd.gitbook.io/efd-cfd-workshop/)은 교수님들과 항공우주연구원의 연구자분들이 주도하에 개최가 된것입니다.
그렇다면 워크샵의 참여자를 생각해보면 일단 항공우주연구원, 국방과학연구원 같은 정출연은 참석할겁니다.
이런 연구소들은 연구인력들의 수준이 아주 높고 인하우스 코드들도 보유하고 있습니다.
또 당연히 대학원을 생각할 수 있습니다.

대학은 랩에 따라 논문이나 발표의 질이 다르긴 합니다. 또 거의 인하우스 코드로 참여하리라 예상이 되었습니다.
대학원의 인하우스 코드는 수년에서 수십년동안 연마된것이기 때문에 
인하우드 코드의 장점 위주로 설명을 하지 않을까 싶었습니다.
또 한편으로는 상용 CFD SW의 기술지원회사에서 참석하리라 생각했습니다.
여기는 자신들의 상용코드로 해석이 정확도가 잘 맞다고 주장할 것입니다.

이런 참석자들이 예상이 되었고 저는 어떤 선택을 했어야 할까요?
일단 당시의 회사에서는 인하우스 코드를 보유하고 있지 못했습니다. 
대신 다른 기관에 비해 다른 점은 다양한 해석 SW에 접근이 가능한 것이었습니다.
회사에서는 한 분야라 하더라도 하나의 상용SW만 구매하지 않고 여러 SW를 구매합니다. 
그래서 저는 가급적 많은 코드를 사용하여 비교하자를 목표로 삼았습니다.
다른 기관들은 논문당 하나의 코드로 해석할게 뻔했거든요.

이 글에서는 논문에 실었던 4개의 CFD SW들의 이야기를 해보려고 합니다.

## 1. Ansys Fluent
일단 Ansys사의 [Fluent](https://www.ansys.com/products/fluids/ansys-fluent)는 제가 주력으로 사용하던 SW였고 가장 자신있게 할 수 있었습니다.
Ansys에 인수된것은 2006년이고 이 때 부터는 "Ansys Fluent"가 정확한 Full Name입니다.
Fluent는 CFD 업계에서 수십년동안 마켓쉐어 1등을 지키고 있는 제품입니다.
명성답게 수많은 유체분야의 해석이 가능하고 강력한 병렬 성능도 가지고 있습니다.
사실 이 논문을 썼던 2017년만 하더라도 솔버는 강력하나 UI적으로는 불편한 면이 있었으나 매년 업데이트로 UI적인면도 크게 개선하여 2020년쯤에는 크게 특별히 불편하지 않았습니다.
2020년 이후로도 눈에 띄는 업데이트를 해왔는데 그 중 저와 관련이 있고 큰 관심이 있는 것만 아래에 간략히 담아보았습니다.
각각의 항목도 하나씩 이야기할거리가 있겠지만 현재 회사에서는 Fluent를 할 라이센스가 없어 제대로 된 분석을 할수는 없겠네요.

### Python 도입
CFD 코드는 계산속도가 매우 중요한 분야이기 때문에 코어 영역은 C++이나 Fortran으로 하는 경우가 대부분입니다.
그런데 오로지 C++같은 코드로만 만들면 코드를 이용한 활용이 어려워집니다.
예를 들면 이 코드를 이용한 배치 작업을 만든다든지 표를 만든다느지 하는 외부작업과의 연결이 어려워집니다.
그래서 Python이나 Perl과 같은 스크립트류의 언어를 결합하는 경우가 많습니다.
보통 CFD를 전공한 사람들은 인하우스 CFD 코드를 접하므로 코드에 익숙하지만 회사에서 상용 SW만을 쓰게 되면 코드를 직접 볼 일이 없으므로 코딩 능력이 퇴화하게 됩니다.
그러나 상용 SW도 고급 단계의 숙련도를 가지려면 그 SW에서 지원하는 스크립트 언어를 익혀서 SW를 자유자재로 쓸 줄 알아야 합니다.
다시 손놓았던 코드를 해야되고(그것도 익숙하지 않은 프로그래밍언어일 것입니다) 여기서 일부 해석 인력들은 도태되고 맙니다.

Fluent는 이 스크립트 지원에 문제가 있었는데요.
Fluent의 스크립크 언어는 [Scheme](https://en.wikipedia.org/wiki/Scheme_(programming_language))입니다.
Scheme은 함수형언어인 Lisp의 일종인데 프로그래밍 언어의 역사적으로는 큰 의미가 있는 언어이나 현재는 사용률이 매우 떨어진 언어입니다.
게다가 CFD하는 사람들은 컴퓨터 공학의 전공자가 아니므로 이런 함수형 언어를 잘 다룰 가능성은 제로에 가깝습니다.
웹에서의 자료도 매우 적고요. 이것이 Fluent가 갖고 있는 몇 안되는 약점이었습니다.
이번에 Python으로 지원을 하면서 이 약점마저 극복하는 모습입니다.
저는 Python을 꽤 오래전부터 해왔고 매우 좋아했습니다.
제가 계속 Fluent를 할 수 있더라면 Python지원은 날개를 다는 수준이었을텐데 아쉬움이 남습니다. 
관련 내용은 Ansys 블로그 [Providing Open-Source Access to Ansys Fluent with PyFluent](https://www.ansys.com/blog/open-source-access-to-fluent-with-pyfluent)에 자세히 설명이 되어 있습니다.

### GPU 지원

AI/ML분야에서는 GPU를 가속기로 사용하는 것이 일반화되어있습니다.
하지만 CFD 분야에서는 GPU 가속이 어려운 분야였습니다.
매우 쉽게 설명하면 이렇습니다.
CPU의 스펙을 이야기할 때 보통 아키텍쳐 세대, 클럭수와 코어수를 이야기합니다.
CFD로 사용하는 서버는 일반적으로 3.0MHz이상의 클럭수와 30코어이상의 서버를 사용합니다.
GPU는 아키텍쳐 세대, 메모리로 많이 이야기하지만 GPU도 사실 코어를 갖고 있습니다. Nvidia에서는 Cuda 코어라고 따로 부릅니다.
예를 들어 Nvidia V100 1장에는 5210 Cuda코어가 있습니다.
물론 CPU의 코어와 GPU의 코어가 같은 역할, 성능을 보여주는건 아닙니다.
비유를 하면 CPU의 코어가 대학생이라면 GPU의 코어는 초등학생입니다.
서로 싸움을 하는데 줄다리기 같은거라면 아무리 대학생 1명이 힘이 세더라도 초등학생 100명을 이길 수는 없습니다.
그런데 미적분 문제 같은거였다면 어떨까요? 100, 1000명의 초등학생이 와도 풀 수가 없습니다.
기존 CFD 문제는 미적분문제 같은거였다고 합시다. 그래서 초등학생에 해당하는 GPU의 코어로는 제대로 성능을 낼 수가 없었던 것입니다.
이것을 해결하려면 문제를 매우 쉽게 쪼개서 초등학생도 할 수 있게 만들어야 합니다.
그런데 지금까지는 기존 레거시 코드를 이리 저리 바꿔도 성공하는 사람은 거의 없었습니다.
그래서 해결한 방법은 차라리 코드를 새로 짜는것 이었습니다.
사실 위에서 설명한 초등학생,대학생,미적분과 같은 비유는 실제 CFD 수치해석 기법과 딱 들어맞는 이야기는 아닙니다.
제가 말하고 싶은 것은 제대로 된 GPU 가속을 위해서는 CFD 코드를 처음부터 다시 짜는 수밖에 없는 것 처럼 보인다는 것입니다. 
Fluent의 GPU솔버의 자세한 세부 코드는 알 수가 없지만 아마 새롭게 코드를 만들었을 것이고 그래서 생각보다 릴리즈하는데 시간이 걸린 것 같습니다.
관련 내용은 Ansys 블로그 [Unleashing the Power of Multiple GPUs for CFD Simulations](https://www.ansys.com/blog/unleashing-the-power-of-multiple-gpus-for-cfd-simulations)에 자세히 설명이 되어 있습니다.

# 2. Ansys CFX
같은 회사의 CFX란 SW는 주로 터보기계에 사용하는 SW인데 저는 대학원에서 접했었고요.
같은 라이센스로 두 SW가 가능하지만 Ansys사가 Fluent 위주로 개발을 해서 회사에서는 거의 사용한 적은 없었습니다.
이번에 옛 기억을 되살려서 CFX도 해보기로 하였습니다.

# 3. Star-CCM+
다음은 지멘스의 Star-CCM+입니다. Star-CCM+은 Fluent에 이어 CFD 분야에서 가장 많이 사용하는 SW중 하나입니다.
Star-CCM+은 Fluent에 비해 차별화되는 장점이 있었고 그런 장점은 좋아했기에 저는 Star-CCM+도 굉장히 많이 해석을 했었습니다.


# 4. SU2

그래서 SU2란 또 다른 오픈소스코드를 하기로 했습니다. 
SU2는 OpenFoam과 다르게 처음부터 압축성 솔버로 되어있어 해석하기 적합했습니다.
오히려 마하수가 낮은 문제가 잘 해석이 안되었습니다.
SU2는 오픈소스로 발표할때부터 관심있게 봐왔던 코드이고 사용에는 제한이 없는 라이센스인 이점을 이용하여
Fluent나 Star-CCM+의 해석들을 보조하는 역할로 사용했었습니다.
워크샵을 위해 제대로 된 해석을 처음 해보는 것이긴 하였습니다.

# 5. OpenFoam
그리고 오픈소스에서 하나쯤은 넣어야겠다고 생각했습니다. 
CFD분야의 오픈소스는 OpenFoam이 가장 유명합니다.
하지만 OpenFoam을 논문에 포함하진 못했는데요.
이 당시에는 OpenFoam이 익숙하지 않았었고 제가 워크샵에서 선택했던 케이스가 해석이 잘 안되었습니다.
구체적으로 이야기하면 마하수가 높아 압축성 솔버가 필요한데 OpenFoam의 압축성 솔버는
수렴이 잘 되지 않았던 것으로 기억을 합니다.


논문에 들어간 코드는 Fluent, CFX, Star-CCM+, SU2입니다.
하지만 제가 검토했던 코드는 더 있었습니다.

# 6. Acusolve
먼저 구조해석분야에서 유명한 Altair Hyperworks 계열의 Acusolve입니다.
Acusolve와 다른 코드와의 가장 큰 차이점은 FEM이란 것입니다. 
FEM은 보통 구조해석에 많이 쓰이고 FVM은 유체해석에 많이 쓰이는데 
Hyperworks는 구조해석 SW가 더 먼저 하다보니 CFD코드도 FEM으로 한게 아닌가 싶습니다.
Acusolve도 본래 Hyperworks를 위해 다른 연구원이 구매한 SW입니다만 
통합 라이센스제도라 Acusolve도 사용이 가능하였고 호기심이 많았던 제가 사용했었습니다.
단 결국 못들어갔던건 마하수 제한때문입니다.
Acusolve 솔버는 그 때 당시 약 마하수 0.3정도에서만 해석이 가능했던 솔버였습니다.
현재는 이 제한이 일부 해소 된것으로 알고 있습니다.


# 7. Comsol
다음은 Comsol입니다.
Comsol은 멀티피직스를 특성화시킨 SW입니다.
다른 SW들에 비해 사용량이 많지는 않으나 몇몇 분야에서는 많이 사용하는것 같습니다.
이 역시 라이센스를 하나 보유하고 있었고 역시 튜토리얼까지는 했었습니다.
그러나 사용법이 익숙하지 않아 포기했었던 SW입니다.

정리하면 저는 7개의 코드를 해석하려고 했습니다. 
CFD분야가 아니라면 감이 안 오시겠지만 CFD를 해보셨다면 7개의 해석 SW를 한명의 연구원이 한다는것이
말도 안된다고 바로 튀어나오는 말입니다.

보통의 CFD하시는 분들은 대학원때는 랩의 인하우스 코드를 쓰다가 회사에 와서는 상용 코드를 많이 쓰게 됩니다.
대부분 상용 SW는 하나를 주력으로 정하고 가끔 열정적이신분은 부로 돌릴만한 코드를 더 공부하긴 합니다.
저처럼 4개를 논문에 쓰고 처음 목적은 7개였다는건 무모한 도전에 가깝습니다.
왜냐하면 CFD사람들이 게을러서 그런건 아니고 1-2개 고급 실력까지 익히는것도 매우 힘들기 때문입니다.
이렇게 많은 코드를 하려고 했다는 것은 오히려 하나도 제대로 못다루면서 이것저것 해보는 사기꾼 취급을 받을 수 있기 때문에 조심해야 합니다. 

