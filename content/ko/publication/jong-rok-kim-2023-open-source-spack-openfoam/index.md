---
title: 오픈소스 설치매니저 Spack에서 OpenFOAM 활용
date: '2023-10-01'
draft: false
publishDate: '2024-01-31T08:00:00Z'
authors:
- ' 김종록'
publication_types:
- '1'
featured: false
publication: '*10th OKUCC*'
---

OKUCC는 OpenFOAM Korea Users’ Community Conference로 넥스트폼에서 주최하는 한국의 오픈폼 커뮤니티 행사입니다.
OpenFOAM을 이전 회사인 한화에서부터 열심히 써봤지만 정작 한화에 다닐때는 가지 못하였고 정작 많이 사용할 수 없는 삼성 SDS에서 발표를 하게 되었습니다.
한화에 있을 때는 OKUCC는 아니지만 매년 학회에 참석했었는데 삼성SDS에 와서는 그러지 못하였습니다.
2년정도 대외 활동을 전혀 하지 못하다가 이 행사에서 다시 하게 되었고 이제 매년 두번씩은 대외 활동을 해야겠다는 목표가 생겼습니다.

OKUCC는 일반적인 학회보다는 가벼운 분위기였지만 그렇다고 발표하는 내용도 쉽지는 않았습니다.
다만 유저 커뮤니티 행사이다 보니 프리젠테이션형식의 발표자료만 공유하고 논문 형태의 자료는 작성하지 않아도 됩니다.
이것은 장점이자 단점인데 발표하는 입장에서는 논문을 작성하는 고생을 하지 않아도 되지만 프리젠테이션으로는 자세한 내용을 알 수가 없다는 아쉬운 점도 있습니다.

그래서 이 포스트에 각 슬라이드에 대한 설명을 담으려고 합니다.

{{< gallery album="okucc2023_sapck" >}}
2장: OpenFOAM의 진입장벽 중 하나는 설치가 어렵다는 것입니다. 설치가 어려운 이유는 OpenFOAM에 필요한 패키지들이 매우 복잡하게 얽혀있기 때문입니다.
컨테이너가 해결사가 될 것이라고 기대를 했지만 아직까지는 HPC 분야의 모든 어플리케이션을 컨테이너로 대체할 수는 없는 상황입니다.

하지만 저는 컨테이너 for HPC도 관심있게 보고 있습니다. 
HPC용 컨테이너에는 Apptainer(Singularity)가 가장 유명하지만 ChalieCloud,Shifter,Sarus,Podman 등 여러 컨테이너가 있으며 이들간의 차이점을 비교하는 것도 재미있을 것 같습니다.

3장: 설치를 할 때 유의할 것은 컴파일 옵션에 따라 성능이 크게 변할 수 있다는 것입니다.
그림은 GROMACS란 오픈소스인데 Intel Cascade Lake에서 각각 다른 옵션으로 컴파일 했을때 성능 차이가 70% 가까이 발생한다는 것입니다.


개인적으로 OpenFOAM에서도 그림과 유사한 테스트를 진행하였지만 큰 차이가 발생하지 않았습니다. 이는 코드의 차이로 인한 것으로 판단했습니다.
단 오픈소스에 따라 성능 차이가 큰 것도 있고 작은 것도 있는데 그 차이가 어디서 발생하는지 분석하는 것도 좋은 주제가 될 것 같습니다. 
그래서 가능하다면 2024년에 OKUCC에는 성능에 테스트를 보완하여 성능에 대한 주제로 발표하 계획이 있습니다.
하지만 성능 분석은 이번 발표 때 했던 노력에 비해 두 배는 어려운 일이라서 포기할수도 있습니다.

최근에는 OpenFOAM의 설치 방법을 최대한 쉽게 제공하는 곳이 많습니다.
단 그림 처럼 성능 측정을 해보면 잘 나오지 않을 가능성이 크고 대부분 mpi설정 문제일 수 있습니다.

4장: 다만 이런 어려움들은 비단 OpenFOAM만 겪었던 것은 아니고 많은 오픈소스 시뮬레이션 SW들이 겪고 있었던 문제입니다.
그래서 Spack이란 오픈소스 패키지 매니저가 미국의 LLNL 연구소에서 개발되었습니다.
Spack은 현재 굉장히 활발한 개발을 하고 있으며 약 7000개의 패키지가 등록되어있습니다.
해외에서는 여러 유수의 슈퍼컴퓨터 센터에서 사용되고 있지만 한국에서는 많이 사용하고 있지 않은 것 같습니다.


5장: 그래서 간단한 Spack 사용법을 담아보았습니다.
Spack은 깃 클론에 의해서 설치할 수 있고 설치 방법은 생략합니다.
Spack의 설치가 되었다면 Spack에서 OpenFOAM을 설치하는 것은 한줄로 가능합니다. 
@, %, +, ^와 같은 식별자를 통해 상세 옵션을 설정할 수도 있습니다.

6~7장: 이런 옵션들은 `spack info openfoam`명령으로 확인할 수 있습니다.
명령어를 실행하면 OpenFOAM에 대한 간단한 설명이 나오고 지원하는 버전이 보여집니다.
Variants는 설치 옵션에 관한 것은 현재 OpenFOAM에서는 10개 이상의 세부 옵션이 있습니다.
Dependencies에서는 필요한 사전 패키지들이 보여집니다. boost, cgal, paraview, mpi 같은 익숙한 써드파티 코드들을 볼 수 있습니다.
즉 이런 써드파티툴도 `spack install`명령에 의해 한번에 설치됩니다.


